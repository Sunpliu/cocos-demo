<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <!-- å¼•å…¥ favicon.ico -->
        <link rel="icon" href="./res/favicon.ico" />
        <!-- æ ‡é¢˜ -->
        <title>Git commit message</title>
        <!-- å¼•å…¥ layui.css -->
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/layui@2.9.21/dist/css/layui.min.css" />

        <style>
            .centered-container {
                min-height: 100vh;
                padding-top: 20px;
                padding-left: 20%;
                padding-right: 20%;
                box-sizing: border-box;
            }
        </style>
    </head>
    <body class="layui-bg-gray">
        <!-- å¼•å…¥ layui.js -->
        <script src="https://cdn.jsdelivr.net/npm/layui@2.9.21/dist/layui.min.js"></script>

        <div class="centered-container" style="background-color: #e2e2e2; color: black">
            <blockquote class="layui-elem-quote"><i class="layui-icon layui-icon-github" style="color: #1e9fff"></i>&nbsp;&nbsp;Git commit message ç”Ÿæˆå·¥å…·</blockquote>

            <!-- ç»™å®¹å™¨è¿½åŠ  class="layui-form-pane"ï¼Œå³å¯æ˜¾ç¤ºä¸ºæ–¹æ¡†é£æ ¼ -->
            <form class="layui-form layui-form-pane" action="" style="margin-top: 16px">
                <div class="layui-form-item">
                    <label class="layui-form-label">æ ‡ç­¾</label>
                    <div class="layui-input-block">
                        <select name="area" lay-filter="aihao"></select>
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">æäº¤æè¿°</label>
                    <div class="layui-input-block">
                        <input type="text" name="commit_desc" autocomplete="off" lay-verify="required" placeholder="æœ¬æ¬¡æäº¤çš„å¤§è‡´å†…å®¹ï¼Œå°½å¯èƒ½ç®€å•ï¼Œæ˜“æ‡‚" class="layui-input" />
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">å…³è”ç¦…é“</label>
                    <div class="layui-input-block">
                        <input type="text" name="zentao_id" autocomplete="off" placeholder="ä»»åŠ¡ï¼št-xxxxxï¼›bug: b-xxxxxï¼›æ²¡æœ‰åˆ™ä¸å¡«å†™" class="layui-input" />
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">å½±å“èŒƒå›´</label>
                    <div class="layui-input-block">
                        <input type="text" name="affect_range" autocomplete="off" class="layui-input" />
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">æµ‹è¯•å»ºè®®</label>
                    <div class="layui-input-block">
                        <input type="text" name="test_suggest" autocomplete="off" class="layui-input" />
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">è¡¥å……è¯´æ˜</label>
                    <div class="layui-input-block">
                        <input type="text" name="extra_desc" autocomplete="off" class="layui-input" />
                    </div>
                </div>

                <div class="layui-form-item">
                    <label class="layui-form-label">é€‚é…ç‰ˆæœ¬</label>
                    <div class="layui-input-block">
                        <input type="text" name="adapt_version" autocomplete="off" lay-verify="required" class="layui-input" />
                    </div>
                </div>

                <div class="layui-form-item">
                    <button class="layui-btn" lay-submit lay-filter="demo2">ç”Ÿæˆ</button>
                    <button type="reset" class="layui-btn layui-btn-primary">é‡ç½®</button>
                </div>
            </form>

            <!-- è¾“å‡ºå†…å®¹ -->
            <div class="layui-bg-gray" id="copy_area" , style="margin-top: 12px; padding: 12px">
                <div class="layui-card">
                    <div class="layui-card-header">main ç‰ˆæœ¬å·</div>
                    <div class="layui-card-body">
                        <textarea placeholder="è¯·è¾“å…¥å†…å®¹" id="text-version-main" class="layui-textarea" style="height: 240px"></textarea>
                        <div class="layui-btn-container" style="margin-top: 10px">
                            <button type="button" class="layui-btn layui-btn-fluid" lay-on="copy-version-main">å¤åˆ¶</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>

    <!-- è„šæœ¬åŒºåŸŸ -->
    <script>
        let area = ['feat: æ–°å¢åŠŸèƒ½ ğŸ˜Š', 'fix: ä¿®å¤è¡¥ä¸ ğŸ”¥', 'perf: æ€§èƒ½ä¼˜åŒ– ğŸ’Š', 'docs: ä¿®è®¢æ–‡æ¡£ ğŸ“–', 'refactor: ä»£ç é‡æ„ ğŸŒ', 'style: ä»£ç æ ¼å¼ ğŸ©', 'test: æ·»åŠ æµ‹è¯• ğŸ¤Œ', 'merge: åˆå¹¶åˆ†æ”¯ ğŸ”—', 'tool: å·¥å…·ç›¸å…³ ğŸ”§', 'revert: å›é€€ç‰ˆæœ¬ ğŸ‘ˆ'];

        // åŠ¨æ€ç”ŸæˆåŒºåŸŸé…ç½®
        const areaConfig = [];
        for (let i = 0; i < area.length; i++) {
            if (i == 0) {
                areaConfig.push({ value: area[i], text: area[i], selected: true });
            } else {
                areaConfig.push({ value: area[i], text: area[i] });
            }
        }

        // åˆå§‹åŒ–åŒºåŸŸé€‰æ‹©å™¨
        function initAreaSelect() {
            const select = document.querySelector('select[name="area"]');
            areaConfig.forEach((area) => {
                const option = document.createElement('option');
                option.value = area.value;
                option.textContent = area.text;
                if (area.selected) {
                    option.selected = true;
                }
                select.appendChild(option);
            });
        }

        initAreaSelect();

        // æµè§ˆå™¨æ¢æˆè¯»å– adapt_version çš„å€¼ï¼Œå¤åˆ¶
        const adapt_version = localStorage.getItem('adapt_version');
        if (adapt_version) {
            document.querySelector('input[name="adapt_version"]').value = adapt_version;
        }

        layui.use(['layer', 'form', 'laydate', 'util'], function () {
            // åˆå§‹åŒ–åŒºåŸŸé€‰æ‹©å™¨
            var form = layui.form;
            var layer = layui.layer;
            var laydate = layui.laydate;
            var util = layui.util;

            util.on('lay-on', {
                'copy-version-main': function () {
                    const textarea = document.getElementById('text-version-main');
                    navigator.clipboard
                        .writeText(textarea.value)
                        .then(() => layer.msg('å¤åˆ¶æˆåŠŸï¼'))
                        .catch((err) => layer.msg('å¤åˆ¶å¤±è´¥: ', err));
                },
            });

            // æäº¤äº‹ä»¶
            form.on('submit(demo2)', function (data) {
                // è·å–è¡¨å•å­—æ®µå€¼
                var field = data.field;
                let commit_type = field['area'];
                let zentao_id = field['zentao_id'].trim();
                let commit_desc = field['commit_desc'].trim();
                let affect_range = field['affect_range'].trim();
                let test_suggest = field['test_suggest'].trim();
                let adapt_version = field['adapt_version'].trim();
                let extra_desc = field['extra_desc'].trim();

                var desc = (commit_type = commit_type.split(':')[0] + ': ' + commit_desc) + '\n';

                if (zentao_id.length > 0) {
                    // æ­£åˆ™åŒ¹é… t- + æ•°å­— ï½œ b- + æ•°å­—
                    const reg = /^[tTbB]-[0-9]+$/;
                    if (reg.test(zentao_id)) {
                        desc += '\n' + 'å…³è”ç¦…é“ï¼š' + zentao_id;
                    } else {
                        layer.msg('ç¦…é“ id æ ¼å¼é”™è¯¯ï¼Œè¯·æ£€æŸ¥ï¼ï¼ï¼');
                        return false;
                    }
                }

                if (affect_range.length > 0) {
                    desc += '\n' + 'å½±å“èŒƒå›´ï¼š' + affect_range;
                }

                if (test_suggest.length > 0) {
                    desc += '\n' + 'æµ‹è¯•å»ºè®®ï¼š' + test_suggest;
                }

                if (extra_desc.length > 0) {
                    desc += '\n' + 'è¡¥å……è¯´æ˜ï¼š' + extra_desc;
                }

                if (adapt_version.length > 0) {
                    desc += '\n' + 'é€‚é…ç‰ˆæœ¬ï¼š>= ' + adapt_version;
                }

                // æµè§ˆå™¨è®°å½• adapt_version çš„å€¼
                localStorage.setItem('adapt_version', adapt_version);

                // main ç‰ˆæœ¬å·
                document.getElementById('text-version-main').value = desc;

                layer.msg('ç”ŸæˆæˆåŠŸï¼');
                return false;
            });
        });
    </script>
</html>
